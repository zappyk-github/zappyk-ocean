#!/bin/env bash
#
CONNECT_tag=${1}    ; shift
QUERYONEROW=${1:-1} ; shift
#
QueryOneRow=true
QueryOneRow=false
#
case "$CONNECT_tag" in
    hrpp ) CONNECT_set='HRPP   zetarw s3rv1c3s' ;;
    hrpt ) CONNECT_set='HRPT   zetarw s3rv1c3s' ;;
    prjp ) CONNECT_set='PRJP   zetarw s3rv1c3s' ;;
    prjt ) CONNECT_set='PRJT   zetarw s3rv1c3s' ;;
    gate ) CONNECT_set='GATE   zetarw s3rv1c3s' ;;
    ibpj ) CONNECT_set='PJ_DWH zetarw s3rv1c3s' ;;
    ibpw ) CONNECT_set='PW_DWH zetarw s3rv1c3s' ;;
    *    ) echo "Connessione DB '$CONNECT_tag' non configurata!"; exit 1 ;;
esac
#
payroll-mssql-cloud_sql_proxy
#
if ( $QueryOneRow );
then
    if [ -z "$*" ];
    then LANG=C isql -b -v $CONNECT_set < <(cat      )
    else LANG=C isql -b -v $CONNECT_set < <(echo "$*")
    fi
else
    if [ -z "$*" ];
   #then LANG=C isql -b -v $CONNECT_set < <(cat       ; echo 'go'; echo '\quit')
   #else LANG=C isql -b -v $CONNECT_set < <(echo "$*" ; echo 'go'; echo '\quit')
    then LANG=C isql -b -v $CONNECT_set < <(cat       | payroll-sql-one-line.pl '' '' $QUERYONEROW)
    else LANG=C isql -b -v $CONNECT_set < <(echo "$*" | payroll-sql-one-line.pl '' '' $QUERYONEROW)
    fi
fi
#
exit
